/bookings:
  post:
    summary: Create a new booking
    description: Creates a booking for a service with payment and location details.
    tags:
      - Bookings
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - serviceId
              - selectedPricingOption
              - scheduledDate
              - scheduledTime
              - location
              - paymentMethod
            properties:
              serviceId:
                type: string
                description: Service ID to book
              selectedPricingOption:
                type: string
                description: Pricing option ID
              specialInstructions:
                type: string
                description: Special instructions for the booking
              scheduledDate:
                type: string
                format: date
                description: Scheduled date (YYYY-MM-DD)
              scheduledTime:
                type: string
                description: Scheduled time (HH:mm or HH:mm:ss or HH:mm:ss.sss)
              location:
                oneOf:
                  - type: string
                    description: Address ObjectId
                  - type: object
                    required:
                      - address
                      - city
                      - state
                      - pincode
                      - coordinates
                    properties:
                      address:
                        type: string
                      city:
                        type: string
                      state:
                        type: string
                      pincode:
                        type: string
                      coordinates:
                        type: object
                        properties:
                          lat:
                            type: number
                          lng:
                            type: number
              paymentMethod:
                type: string
                enum: [cash, card, upi]
                description: Payment method
    responses:
      '201':
        description: Booking created successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                booking:
                  type: object
                order:
                  type: object
      '400':
        description: Invalid input
      '404':
        description: Service or address not found
      '500':
        description: Booking creation failed
  get:
    summary: Get bookings (user/provider, filter by status)
    description: |
      Retrieve bookings for the authenticated user or provider.
      - For users: Returns bookings filtered by status (e.g. booking-requested, booking-confirmed, etc.).
      - For providers: If status is 'booking-requested', latitude and longitude query parameters are required to filter available bookings by location. For other statuses, returns bookings where provider matches user.
      Query parameters:
        - status: Booking status to filter (optional)
        - latitude: Required for providers when status is 'booking-requested'
        - longitude: Required for providers when status is 'booking-requested'
    tags:
      - Bookings
    security:
      - BearerAuth: []
    parameters:
      - name: status
        in: query
        required: false
        schema:
          type: string
        description: Booking status to filter (e.g. booking-requested, booking-confirmed, etc.)
      - name: latitude
        in: query
        required: false
        schema:
          type: number
          format: float
        description: Latitude (required for provider when status is booking-requested)
      - name: longitude
        in: query
        required: false
        schema:
          type: number
          format: float
        description: Longitude (required for provider when status is booking-requested)
    responses:
      '200':
        description: Bookings retrieved
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    bookings:
                      type: array
                      items:
                        $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '204':
        description: No bookings found
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    bookings:
                      type: array
                      items:
                        $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '400':
        description: Bad request (missing coordinates for provider)
      '500':
        description: Internal server error
/bookings/all:
  get:
    summary: Get all bookings (admin/testing)
    description: Retrieve all bookings in the system, with optional status filter. Intended for admin or testing purposes.
    deprecated: true
    tags:
      - Bookings
    parameters:
      - in: query
        name: status
        schema:
          type: string
        required: false
        description: Filter bookings by status
    responses:
      '200':
        description: List of all bookings
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    bookings:
                      type: array
                      items:
                        $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '500':
        description: Server error
/bookings/{bookingId}:
  get:
    summary: Get booking by ID
    description: Retrieve a single booking by its ObjectId, including populated service, user, provider, and location details.
    tags:
      - Bookings
    security:
      - BearerAuth: []
    parameters:
      - in: path
        name: bookingId
        required: true
        schema:
          type: string
        description: The ObjectId of the booking to retrieve
    responses:
      '200':
        description: Booking retrieved successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '400':
        description: Invalid booking ID
      '404':
        description: Booking not found
      '500':
        description: Server error
/bookings/reject:
  post:
    summary: Provider rejects a booking (does not change booking status)
    description: >
      Provider can reject a booking. This does not change the booking status, but records the rejection for this provider. Rejected bookings will not be shown to this provider in getAvailableBookings.
    tags:
      - Bookings
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - bookingId
            properties:
              bookingId:
                type: string
                description: The ObjectId of the booking to reject
              reason:
                type: string
                description: Optional reason for rejection
    responses:
      '200':
        description: Booking rejected for this provider (not shown in available bookings)
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                message:
                  type: string
      '400':
        description: Invalid request
      '404':
        description: Booking not found
      '500':
        description: Server error
/bookings/accepted:
  get:
    summary: Get accepted bookings or booking history for provider
    tags:
      - Bookings
    security:
      - BearerAuth: []
    parameters:
      - in: query
        name: status
        schema:
          type: string
        required: false
        description: Filter bookings by status (booking-confirmed, booking-in-progress, booking-completed)
    responses:
      '200':
        description: Accepted bookings/history retrieved
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    bookings:
                      type: array
                      items:
                        $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '401':
        description: Unauthorized
      '500':
        description: Server error
/bookings/accept:
  post:
    summary: Provider accepts a booking
    tags:
      - Bookings
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - bookingId
            properties:
              bookingId:
                type: string
                description: The ObjectId of the booking to accept
    responses:
      '200':
        description: Booking accepted successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    booking:
                      $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '400':
        description: Invalid request or booking status
      '403':
        description: Provider not approved for this service
      '404':
        description: Booking not found
      '500':
        description: Server error

/booking/history:
  get:
    summary: Get booking history for logged-in user
    deprecated: true
    tags:
      - Bookings
    security:
      - BearerAuth: []
    parameters:
      - in: query
        name: status
        schema:
          type: string
        required: false
        description: Filter bookings by status
    responses:
      '200':
        description: List of bookings
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    bookings:
                      type: array
                      items:
                        $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string

/bookings/available:
  get:
    deprecated: true
    summary: Get available bookings for provider (location-based)
    description: >
      Returns bookings for services and locations where the provider is approved and matches the user's current location (latitude/longitude). The API uses coordinates (as query parameters) to determine pincode and matches with provider's approved service areas.
    tags:
      - Bookings
    security:
      - BearerAuth: []
    parameters:
      - in: query
        name: latitude
        required: true
        schema:
          type: number
          format: float
        description: Latitude of provider's current location
      - in: query
        name: longitude
        required: true
        schema:
          type: number
          format: float
        description: Longitude of provider's current location
    responses:
      '200':
        description: List of available bookings
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    bookings:
                      type: array
                      items:
                        $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '400':
        description: Missing or invalid coordinates
      '404':
        description: No pincode found for provided coordinates
      '204':
        description: No services available for your location
      '500':
        description: Server error
/bookings/in-progress:
  deprecated: true
  post:
    summary: Provider marks booking as in-progress
    description: >
      Provider marks a booking as in-progress. Requires bookingId, latitude, and longitude in the request body. The API checks if the provider's current location pincode matches the booking address pincode.
    tags:
      - Bookings
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - bookingId
              - latitude
              - longitude
            properties:
              bookingId:
                type: string
                description: The ObjectId of the booking
              latitude:
                type: number
                format: float
                description: Provider's current latitude
              longitude:
                type: number
                format: float
                description: Provider's current longitude
    responses:
      '200':
        description: Booking marked in-progress
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    booking:
                      $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '400':
        description: Invalid request or pincode mismatch
      '404':
        description: Booking not found or no pincode found
      '500':
        description: Server error
/bookings/complete:
  post:
    summary: Provider marks booking as completed
    description: >
      Provider marks a booking as completed. Requires bookingId, latitude, and longitude in the request body. The API checks if the provider's current location pincode matches the booking address pincode.
    tags:
      - Bookings
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - bookingId
              - latitude
              - longitude
            properties:
              bookingId:
                type: string
                description: The ObjectId of the booking
              latitude:
                type: number
                format: float
                description: Provider's current latitude
              longitude:
                type: number
                format: float
                description: Provider's current longitude
    responses:
      '200':
        description: Booking marked as completed
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    booking:
                      $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '400':
        description: Invalid request or pincode mismatch
      '404':
        description: Booking not found or no pincode found
      '500':
        description: Server error
/bookings/cancel:
  post:
    summary: Provider cancels a booking
    description: >
      Provider cancels a booking. Requires bookingId, latitude, longitude, and optional cancellationReason in the request body. The API checks if the provider's current location pincode matches the booking address pincode.
    tags:
      - Bookings
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - bookingId
              - latitude
              - longitude
            properties:
              bookingId:
                type: string
                description: The ObjectId of the booking
              latitude:
                type: number
                format: float
                description: Provider's current latitude
              longitude:
                type: number
                format: float
                description: Provider's current longitude
              cancellationReason:
                type: string
                description: Optional reason for cancellation
    responses:
      '200':
        description: Booking marked as cancelled
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    booking:
                      $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '400':
        description: Invalid request or pincode mismatch
      '404':
        description: Booking not found or no pincode found
      '500':
        description: Server error

  /bookings/{status}:
    get:
      summary: Get bookings by status (user or provider)
      description: |
        Returns bookings for the authenticated user or provider. If the user is a provider and status is 'booking-requested', latitude and longitude are required to filter available bookings. For other statuses, returns bookings where provider matches user.
      tags:
        - Bookings
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: path
          required: true
          schema:
            type: string
          description: Booking status to filter (e.g. booking-requested, booking-confirmed, etc.)
        - name: latitude
          in: query
          required: false
          schema:
            type: number
            format: float
          description: Latitude (required for provider when status is booking-requested)
        - name: longitude
          in: query
          required: false
          schema:
            type: number
            format: float
          description: Longitude (required for provider when status is booking-requested)
      responses:
        '200':
          description: Bookings retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      bookings:
                        type: array
                        items:
                          $ref: './../schemas/booking.yaml#/Booking'
                  message:
                    type: string
        '204':
          description: No bookings found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      bookings:
                        type: array
                        items:
                          $ref: './../schemas/booking.yaml#/Booking'
                  message:
                    type: string
        '400':
          description: Bad request (missing coordinates for provider)
        '500':
          description: Internal server error

/bookings/update-status:
  post:
    summary: Update booking status (generic)
    description: >
      Update the status of a booking to any allowed value. For status values 'booking-confirmed', 'booking-in-progress', and 'booking-completed', the API checks if the user's location pincode matches the booking address pincode using latitude and longitude.
    tags:
      - Bookings
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - bookingId
              - status
            properties:
              bookingId:
                type: string
                description: The ObjectId of the booking
              status:
                type: string
                enum:
                  - booking-requested
                  - booking-confirmed
                  - booking-in-progress
                  - booking-completed
                  - booking-cancelled
                  - booking-rejected
                description: New status to set for the booking
              latitude:
                type: number
                format: float
                description: User's current latitude (required for certain status updates)
              longitude:
                type: number
                format: float
                description: User's current longitude (required for certain status updates)
    responses:
      '200':
        description: Booking status updated
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                data:
                  type: object
                  properties:
                    booking:
                      $ref: './../schemas/booking.yaml#/Booking'
                message:
                  type: string
      '400':
        description: Invalid request or pincode mismatch
      '404':
        description: Booking not found or no pincode found
      '500':
        description: Server error
